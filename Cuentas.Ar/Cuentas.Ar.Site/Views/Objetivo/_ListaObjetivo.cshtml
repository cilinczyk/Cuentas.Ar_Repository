@model List<Cuentas.Ar.Entities.Objetivo>

<!-- #region Include DataTable -->
<link href="~/Content/DataTables/datatables.min.css" rel="stylesheet" />
<script src="~/Content/DataTables/datatables.min.js"></script>
<!-- #endregion Include DataTable-->

<div class="container-fluid" id="ListaObjetivo">
    <div class="row">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header card-header-primary card-header-icon">
                    <div class="card-icon">
                        <i class="material-icons">accessibility_new</i>
                    </div>
                    <div class="card-title">
                        <h4>Objetivos @Html.NoEncodeActionLink("<i class='material-icons'>add</i> Nuevo Objetivo", "Nuevo", "Alta", "Objetivo", htmlAttributes: new { data_modal = "", @class = "btn btn-success btn-sm pull-right", id = "btnAlta" })</h4>
                    </div>

                </div>
                <div class="card-body">
                    <div class="toolbar">
                        <!-- Here you can write extra buttons/actions for the toolbar -->
                    </div>
                    <div class="material-datatables">
                        <div id="datatables_wrapper" class="dataTables_wrapper dt-bootstrap4">
                            <div class="row">
                                <div class="col-sm-12">
                                    <table id="tableObjetivo" class="table table-striped table-no-bordered table-hover dataTable dtr-inline" style="width: 100%;" role="grid" aria-describedby="datatables_info" width="100%" cellspacing="0">
                                        <thead>
                                            <tr role="row">
                                                <th class="sorting col-md-3" tabindex="0" aria-controls="datatables" rowspan="1" colspan="1">Motivo</th>
                                                <th class="sorting" tabindex="0" aria-controls="datatables" rowspan="1" colspan="1">Estado</th>
                                                <th class="sorting" tabindex="0" aria-controls="datatables" rowspan="1" colspan="1">Importe</th>
                                                <th class="sorting" tabindex="0" aria-controls="datatables" rowspan="1" colspan="1">Moneda</th>
                                                <th class="sorting" tabindex="0" aria-controls="datatables" rowspan="1" colspan="1">Fecha</th>
                                                <th class="disabled-sorting text-right col-md-2" tabindex="0" aria-controls="datatables" rowspan="1" colspan="1" orderable="false">Acción</th>
                                            </tr>
                                        </thead>
                                        <tfoot>
                                            <tr>
                                                <th rowspan="1" colspan="1">Motivo</th>
                                                <th rowspan="1" colspan="1">Estado</th>
                                                <th rowspan="1" colspan="1">Importe</th>
                                                <th rowspan="1" colspan="1">Moneda</th>
                                                <th rowspan="1" colspan="1">Fecha</th>
                                                <th class="text-right" rowspan="1" colspan="1">Acción</th>
                                            </tr>
                                        </tfoot>
                                        <tbody>
                                            @{
                                                var posicion = 1;
                                                var colorClass = "odd";

                                                foreach (var item in Model)
                                                {
                                                    colorClass = (posicion % 2 == 0) ? "even" : "odd";

                                            <tr role="row" class="@colorClass">
                                                <td>@item.Motivo</td>
                                                <td class="sorting_1">@item.EstadoObjetivo.Descripcion</td>
                                                <td>@string.Format(new System.Globalization.CultureInfo("es-AR"), "{0:N2}", item.Importe)</td>
                                                <td>@item.Moneda.Descripcion</td>
                                                <td>@item.Fecha.ToShortDateString()</td>
                                                <td class="text-right">
                                                    @Html.NoEncodeActionLink("<i class='material-icons'>dvr</i>", "Detalle", "Detalle", "Objetivo", routeValues: new { idObjetivo = @item.idObjetivo }, htmlAttributes: new { data_modal = "", @class = "btn btn-link btn-warning btn-just-icon edit" })
                                                    @Html.NoEncodeActionLink("<i class='material-icons'>edit</i>", "Modificar", "Edicion", "Objetivo", routeValues: new { idObjetivo = @item.idObjetivo }, htmlAttributes: new { data_modal = "", @class = "btn btn-link btn-info btn-just-icon like" })
                                                    @Html.NoEncodeActionLink("<i class='material-icons'>close</i>", "Eliminar", "Baja", "Objetivo", routeValues: new { idObjetivo = @item.idObjetivo, motivo = @item.Motivo, importe = @item.Importe }, htmlAttributes: new { data_modal = "", @class = "btn btn-link btn-danger btn-just-icon remove" })
                                                </td>
                                            </tr>
                                                }
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        $('#tableObjetivo').DataTable({
            "columns": [
                { "orderable": true },
                { "orderable": true },
                { "orderable": true },
                { "orderable": true },
                { "orderable": true },
                { "orderable": false },
            ],
            "pagingType": "full_numbers",
            "lengthMenu": [
                [10, 25, 50, -1],
                [10, 25, 50, "All"]
            ],
            responsive: true,
            language: {
                "sProcessing": "Procesando...",
                "sLengthMenu": "Mostrar _MENU_ registros",
                "sZeroRecords": "No se encontraron resultados",
                "sEmptyTable": "Ningún dato disponible en esta tabla",
                "sInfo": "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
                "sInfoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
                "sInfoFiltered": "(filtrado de un total de _MAX_ registros)",
                "sInfoPostFix": "",
                "sUrl": "",
                "sInfoThousands": ",",
                "sLoadingRecords": "Cargando...",
                "search": "_INPUT_",
                "searchPlaceholder": "Buscar Objetivo",
                "oPaginate": {
                    "sFirst": "Primero",
                    "sLast": "Último",
                    "sNext": "Siguiente",
                    "sPrevious": "Anterior"
                },
                "oAria": {
                    "sSortAscending": ": Activar para ordenar la columna de manera ascendente",
                    "sSortDescending": ": Activar para ordenar la columna de manera descendente"
                },
            }
        });

        $("#ListaObjetivo a[data-modal]").on("click", function (e) {
            $('#ModalGeneralBody').load(this.href, function () {
                $('#ModalGeneral').modal({
                    keyboard: true,
                    backdrop: 'static'
                }, 'show');
                bindModal(this);
            });
            return false;
        });

        function bindModal(dialog) {
            $('form', dialog).submit(function () {
                $.ajax({
                    url: this.action,
                    type: this.method,
                    data: $(this).serialize(),
                    success: function (result) {
                        if (result.success) {
                            $('#ModalGeneral').modal('hide');
                            $('#ListaObjetivo').load(result.url);
                        } else {
                            $('#ModalGeneralBody').html(result);
                            bindModal(dialog);
                        }
                    }
                });
                return false;
            });
        }
    });
</script>